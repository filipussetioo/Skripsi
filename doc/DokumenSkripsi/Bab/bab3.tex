\chapter{Analisis}
\label{chap:analisis}
\section{Analisis konversi menuju \textit{CodeIgniter 4}}
Konversi \textit{CodeIgniter 3} menuju \textit{CodeIgniter 4} diperlukan penulisan ulang karena terdapat perubahan struktur aplikasi dan beberapa fungsi yang memiliki pemanggilan berbeda dan harus dilakukan pembaharuan.
\subsection{Persiapan \textit{CodeIgniter 4}} Konversi dimulai dengan mempersiapkan aplikasi \textit{CodeIgniter 4} dengan mengunduh ataupun memasangnya melalui \textit{Composer}. Pengguna juga perlu memasang komponen pendukung seperti \textit{Twig}, \textit{phpoffice}, \textit{radius}, dan \textit{adldap2}.
\subsection{Pemindahan \textit{file} dari \textit{CodeIgniter 3} ke \textit{CodeIgniter 4}}


\subsection{Pembaharuan \textit{file-file CodeIgniter 3} }

\subsection{Struktur Aplikasi}
Struktur aplikasi pada \textit{CodeIgniter 3} dan \textit{CodeIgniter 4} memiliki perubahan sehingga perlu dilakukan pemindahan \textit{file-file} menuju \textit{CodeIgnter 4}. Berikut merupakan tujuan \textit{file-file} yang akan dipindahkan menuju \textit{CodeIgniter 4}:
\subsubsection{Application}
Direktori-direktori \texttt{application} pada \textit{CodeIgniter 3} akan dipindahkan menuju direktori \texttt{app} terkecuali direktori \texttt{vendor}, \texttt{cache} dan \texttt{core}. Berikut merupakan direktori yang dipindahkan dari direktori \textit{application} menuju direktori \textit{app}.
\begin{itemize}
\item \verb|application/config| akan dipindahkan menuju \texttt{app/Config}.
\item \verb|application/controllers| akan dipindahkan menuju \texttt{app/Controllers}.
\item \verb|application/helpers| akan dipindahkan menuju \texttt{app/Helpers}.
\item \verb|application/languange| akan dipindahkan menuju \texttt{app/Languange}.
\item \verb|application/libraries| akan dipindahkan menuju \texttt{app/Libraries}.
\item \verb|application/models| akan dipindahkan menuju \texttt{app/Models}.
\end{itemize}

\subsubsection{\textit{Public}}
\textit{CodeIgniter 3} tidak menyediakan direktori akar berupa \textit{public} sehingga terdapat perubahan struktur dimana direktori yang sebelumnya ada pada \texttt{application} akan dipindah menuju direktori \texttt{public}. Berikut merupakan direktori yang dipindahkan menuju direktori \texttt{public}.
\begin{itemize}
\item \verb|assets| akan dipindahkan menuju \texttt{app/assets}.
\item \verb|application/views| akan dipindahkan menuju \texttt{app/views}.
\end{itemize}

Selain stuktur aplikasi diatas, \textit{SharIF Judge} memiliki dua buah direktori terpisah diluar direktori utama bernama \textit{assignments} dan \textit{tester}. Direktori \textit{assignments} ini berfungsi untuk menyimpan seluruh \textit{file} yang telah dikumpulkan sedangkan direktori \textit{tester} digunakan untuk melakukan percobaan untuk keamanan \textit{sandbox}. Kedua direktori ini harus dapat ditulis oleh \textit{PHP} sehingga akan dipindahkan menuju direktori \textit{writables}.

\subsubsection{\textit{Writables}}
Direktori ini merupakan direktori berisikan seluruh direktori yang dapat ditulis oleh \textit{PHP}. Berikut merupakan direktori yang dipindahkan menuju \textit{writables}.
\begin{itemize}
\item \verb|application/cache| akan dipindahkan menuju \texttt{writables/logs}.
\item \verb|assignments| akan dipindahkan menuju \texttt{writables/assignments}.
\end{itemize}

\subsection{\textit{Routing}}
\textit{Routing} pada aplikasi \textit{SharIF Judge} menggunakan \textit{auto routing} yang telah disediakan oleh \textit{CodeIgniter 3}. \textit{Auto routing} akan membentuk \textit{url} sesuai dengan \textit{controller} dan \textit{method} yang telah dibentuk tanpa harus didefinisikan secara manual. Penggunaan \textit{auto routing} seperti pada \textit{CodeIgniter 3} memiliki kekurangan pada bagian keamanan dimana \textit{filter} pada \textit{controller} dan proteksi \textit{CSRF} akan dilewati. Sehingga, konversi pada aplikasi \textit{SharIF Judge} akan menggunakan \textit{URI Routing} yang didefinisikan secara manual untuk alasan keamanan dan \textit{url} yang fleksibel.

\subsection{\textit{Model, View, and Controller}}
\textit{CodeIgniter 4} memiliki perubahan baik dari kegunaan dan cara pemanggilan \textit{Model, View, and Controller}. Berikut merupakan perubahan yang terjadi:
\subsubsection{\textit{Model}}
\textit{Model} pada \textit{CodeIgniter 4} memiliki perubahan dimana \textit{model} dapat digunakan untuk mengambil data pada satu buah tabel spesifik. Konversi \textit{model} dari \textit{CodeIgniter 3} menuju \textit{CodeIgniter 4} dapat dilakukan menggunakan dua buah cara yakni:
\begin{enumerate}
\item Menggunakan \textit{Model} dari \textit{CodeIgniter 3}

\textit{Model} pada \textit{CodeIgniter 3} memiliki kekurangan dimana pengguna harus membentuk secara manual seluruh fungsi untuk mengambil, memasukan, dan memperbaharui data dari sebuah tabel spesifik pada \textit{model} tersebut.

\item Menggunakan \textit{Model} pada \textit{CodeIgniter 4}

\textit{CodeIgnier 4} menyediakan fungsi \textit{model} yang dapat dibentuk melalui \textit{command line} untuk sebuah tabel spesifik. Pengguna dapat membentuk \textit{model} melalui \textit{command line} menggunakan sintaks sebagai berikut.
\begin{center}
	\verb|make:model <name>|
\end{center}
\textit{Model} pada \textit{CodeIgniter 4} menyediakan fungsi untuk mengambil, memasukan, dan memperbaharui data dari sebuah tabel spesifik tanpa harus membentuk secara manual fungsi-fungsi tersebut. Pengguna dapat memakai fungsi untuk mengambil data menggunakan sintaks berikut.
\begin{center}
	\verb|$userModel = new \App\Models\UserModel();|
\end{center}
\begin{center}
	\verb|$user = $userModel->find($user_id);|
\end{center}
\end{enumerate}

Sintaks diatas berguna untuk mencari data dengan parameter \texttt{\$user\_id}. Konversi aplikasi \textit{SharIF Judge} akan menggunakan kedua buah cara dengan penghapusan beberapa fungsi yang terdapat pada \textit{model} dari \textit{CodeIgniter 4} seperti mengambil, menghapus, dan menambahkan data. Sedangkan untuk fungsi-fungsi lain pada \textit{SharIF Judge} akan dilakukan pembaharuan sesuai dengan dokumentasi yang telah ada.

\subsubsection{\textit{View}}
\textit{View} pada aplikasi \textit{SharIF Judge} menggunakan \textit{template engine} bernama \textit{Twig}. \textit{Twig} merupakan sebuah \textit{template engine} untuk bahasa pemrograman \textit{PHP} yang berguna untuk mempermudah dalam mebentuk tampilan sebuah aplikasi. Konversi \textit{SharIF Judge} akan menggunakan \textit{Twig} yang telah diintegrasikan pada \textit{CodeIgnier 4} dengan perubahan beberapa sintaks. \textit{Twig} dapat diintegrasikan pada \textit{CodeIgnier 4} menggunakan \textit{composer} dengan penambahan beberapa sintaks pada \textit{initController}.

\subsubsection{\textit{Controller}}
\textit{Controller} pada \textit{CodeIgniter 4} memiliki fungsi sama dengan pada \textit{CodeIgniter 3} sehingga hanya perlu dilakukan penghapusan dan perubahan pada sintaks yang ada. Namun, terdapat perubahan pada \texttt{constructor} dimana pada \textit{CodeIgniter 4} terdapat \texttt{initController}. \textit{Constructor} pada \textit{PHP} tidak diperbolehkan untuk mengembalikan apapun sehingga terdapat beberapa pemindahan fungsi seperti \texttt{redirect()} menuju \textit{filters}. Selain itu, beberapa sintaks yang digunakan oleh kebanyakan \textit{controller} pada \texttt{constructor} akan dipindahkan menuju \texttt{initController} seperti pemanggilan \textit{file config}. Fungsi lainnya akan dipindahkan sesuai dengan yang ada pada \textit{CodeIgniter 3} dengan pembaharuan sesuai dengan dokumentasi \textit{CodeIgniter 4}.

\subsection{\textit{Libraries}}
\textit{Libraries} pada \textit{CodeIgniter 3} memiliki perubahan dan penghapusan pada \textit{CodeIgnier 4} sehingga perlu dilakukan pembaharuan. Berikut merupakan \textit{libraries} yang dipakai pada \textit{SharIF Judge}:
\subsubsection{\textit{Configuration}}
\textit{Configuration} memiliki perubahan nama dan perpindahan beberapa sintaks. Perubahan nama terdapat pada \verb|application/config/config.php| menjadi \texttt{app/Config/App.php}. Selain itu, berikut merupakan sintaks yang dipindahkan menuju \texttt{app/Config/Security.php}:
\begin{itemize}
\item \verb|$config['csrf_protection'] = TRUE;|
\item \verb|$config['csrf_token_name'] = 'shj_csrf_token';|
\item \verb|$config['csrf_cookie_name'] = 'shjcsrftoken';|
\item \verb|$config['csrf_expire'] = 7200;|
\item \verb|$config['csrf_regenerate'] = FALSE;|
\end{itemize}

\textit{Configurations} yang telah dipindahkan akan diubah dari yang sebelumnya menggunakan \textit{array} menjadi menggunakan \textit{variable}. Seluruh \textit{configurations} pada \textit{CodeIgniter 3} akan dipindahkan menuju \textit{CodeIgniter 4} sesuai dengan direktorinya dan fungsinya.

\subsubsection{\textit{Database}}
\textit{Database} pada \textit{CodeIgniter 4} fungsi yang sama pada \textit{CodeIgniter 3} sehingga akan dilakukan pemindahan konfigurasi sesuai dengan yang ada pada \textit{CodeIgniter 3}. Namun, terjadi beberapa perubahan pada sintaks untuk melakukan koneksi ke \textit{database} dan beberapa sintaks untuk melakukan \textit{query}. Sintaks koneksi \textit{database} akan berubah dari \texttt{\$this->load->database();} menjadi \texttt{db = db\_connect()}. Selain itu, pemanggilan fungsi \textit{query builder} berubah menggunakan \textit{camelcase} dari yang sebelumnya menggunakan \textit{snakecase}. Seperti dari yang sebelumnya menggunakan sintaks \texttt{get\_where} menjadi \texttt{getWhere}.

\subsubsection{\textit{Emails}}
\textit{Emails} pada \textit{CodeIgnier 3} terdapat perubahan sintaks dan cara pemanggilan sehingga akan dipindahkan sesuai dengan sintaks yang baru. Sintaks berubah dari yang sebelumnya menggunakan \textit{snakecase} menjadi menggunakan \textit{camelcase}.

\subsubsection{\textit{Working with Uploaded Files}}
\textit{Working with uploaded files} terdapat perubahan pada beberapa sintaks dan validasi terhadap \textit{file} yang telah diunggah. Konversi aplikasi \textit{SharIF Judge} akan menggunakan fungsi ini dengan beberapa perubahan sintaks sesuai dengan dokumentasinya.

\subsubsection{\textit{Validations}}
\textit{Validations} terdapat perubahan dan pengapusan beberapa fungsi.

\textit{CodeIgniter 4} tidak menyediakan fungsi \texttt{form\_error} sehingga akan diubah dengan menggunakan fungsi baru bernama \texttt{validation\_errors()}.

Selain \textit{library} yang terdapat pada \textit{CodeIgnier 4}, berikut merupakan \textit{library} yang dibentuk oleh pengguna. Berikut merupakan \textit{library} yang dibentuk oleh pengguna.

\subsubsection{\textit{Password\_hash}}
\textit{Library} ini dibentuk oleh \textit{phpass} untuk melakukan enkripsi \textit{password} dan melakukan verifikasi \textit{password}. \textit{Phpass} merupakan \textit{library} 

\textit{Phpass} hanya mendukung \textit{PHP} versi 5 sampai dengan 7. Sehingga, akan dilakukan konversi menggunakan fungsi yang disediakan oleh \textit{PHP} bernama \texttt{password\_hash()}. Seluruh penggunaan \textit{library} ini akan diubah menggunakan fungsi yang disediakan oleh \textit{PHP} dengan metode \textit{hashing} sama yaitu \textit{CRYPT\_BLOWFISH}.

\subsubsection{\textit{Helpers}}
\textit{Helpers} tidak terdapat banyak perubahan namun, terdapat perubahan pemanggilan \textit{helpers} dan beberapa penghapusan \textit{helpers}. Berikut merupakan \textit{helpers} yang dihapus dan diubah cara pemanggilannya.
\begin{itemize}
\item \textit{Download Helper}
\textit{Helper} ini sudah tidak tersedia pada \textit{CodeIgniter 4} sehingga perlu dilakukan pengubahan dengan menggunakan fungsi \textit{HTTP Response}. \textit{HTTP Response} menyediakan fungsi bernama \textit{Force File Download} yang berguna untuk mengunduh sebuah \textit{file} menuju perangkat pengguna. Fungsi ini dapat dipanggil menggunakan sintaks berikut.

\begin{center}
 \verb|return $this->response->download($name, $data);|
\end{center}

Sintaks diatas mengembalikan \textit{file} yang ingin diunduh pengguna dengan dua buah parameter. Parameter pertama berupa nama \textit{file} yang ingin diunduh sedangkan parameter kedua merupakan data dalam \textit{file} tersebut.

\item \texttt{redirect()} \\
Fungsi ini memiliki perubahan pada \textit{CodeIgniter 4} dimana \texttt{redirect()} tidak langsung mengarahkan kepada \textit{url} yang dibentuk. Pengguna harus mengembalikan fungsi \textit{redirect()} menggunakan \texttt{return} menggunakan sintaks sebagai berikut.
\begin{center}
 \verb|return redirect()->to('login/form')|
\end{center} 

Sintaks diatas akan mengembalikan pengguna menuju \textit{url} \texttt{login/form} yang sudah dibentuk pada \textit{routes}.

\end{itemize}

